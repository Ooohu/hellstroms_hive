<?xml version="1.0" ?>

<!-- Some basic information, a tag that defines uniquely this analysis, and a topology that also defines it -->
<topology tag="antinu" name ="#bar{#nu}_{e}" def = "1" bdtcut = "( 0.75, 0.85, 0.95, 0.95, 0.95, 0.95)"/> 
<filedir>/scratch/condor-tmp/klin/data_timing_root/antinu_analysis/</filedir>

<!-- ================================================== BDT FILES [First the ones that we stack in things]==================================================== -->
<!--plot_on_top="true" means that the plot will not be considered as part of the ratio, and it will be just plotted on top-->
<!--
<bdtfile filename = "timing_MC_fullosc_may07_2.root" tag = "fullosc" hist_style = "hist" dirs = "" col = "(255,255,255)" linecol = "1" linestyle = "7" plot_name = "best-fit" scale = "1.0" signal = "true" plot_on_top = "false" weight = "wgt*pow(1.267*0.04*nuleng/enugen,2)">
    <definition>
        <cut> (backgroundType==1||backgroundType==2||backgroundType==3) </cut>
        <cut> Entry$%2==0 </cut>
    </definition>
	<fixPOT> 6.639e19 </fixPOT>
</bdtfile>
<bdtfile filename = "timing_MC_fullosc_may07_2.root" tag = "fullosc2" hist_style = "hist" dirs = "" col = "(233,233,233)" linecol = "1" linestyle = "7" plot_name = "fullosc" scale = "1.0" signal = "true" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> (backgroundType==1||backgroundType==2||backgroundType==3) </cut>
        <cut> Entry$%2==0 </cut>
		<cut> el.EnuQE&lt;-999 </cut>
    </definition>
	<fixPOT> 6.639e19 </fixPOT>
</bdtfile>
-->

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "other_numu" hist_style = "hist" dirs = "" col = "(163,143,163)" plot_name = "#bar{#nu}_{#mu}/#nu_{#mu}" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> backgroundType==11 </cut>
        <cut> Entry$%2==0 </cut>
		<cut> MCBEAM.ntp&gt;2</cut>
    </definition>
	<fixPOT> 1.3953E22 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "other" hist_style = "hist" dirs = "" col = "(153,153,153)" plot_name = "Other" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> backgroundType==11 </cut>
        <cut> Entry$%2==0 </cut>
		<cut> MCBEAM.ntp&lt;3</cut>
    </definition>
	<fixPOT> 1.3953E22 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_dirt_may07.root" tag = "dirt" hist_style = "hist" dirs = "" col = "(137,104,89)" plot_name = "dirt" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> Entry$%2==0 </cut>
    </definition>
	<fixPOT> 6.781824e21 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "delta" hist_style = "hist" dirs = "" col = "(222,186,135)" plot_name = "#Delta#rightarrow N#gamma" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> backgroundType==10 </cut>
        <cut> Entry$%2==0 </cut>
    </definition>
	<fixPOT> 1.3953E22 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "pi0misid" hist_style = "hist" dirs = "" col = "(207,94,97)" plot_name = "#pi^{0} misid" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> backgroundType==9 </cut>
        <cut> Entry$%2==0 </cut>
    </definition>
	<fixPOT> 1.3953E22 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "intrinsicnue" hist_style = "hist" dirs = "" col = "(176,207,199)" plot_name = "Intrinsic #nu_{e}" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> (backgroundType&gt;0) </cut>
        <cut> (backgroundType&lt;6) </cut>
        <cut> Entry$%2==0 </cut>
    </definition>
	<fixPOT> 1.3953E22 </fixPOT>
</bdtfile>

<!-- DATA!!!!-->
<bdtfile filename = "timing2_data_antinu_nue.root" tag = "data" hist_style = "hist" dirs = "" col = "(0.2,0.8,0.2)" plot_name = "Data" fillstyle = "3333" scale = "1">
    <definition>
		<cut>1</cut>
    </definition>
	<fixPOT> 11.27e20 </fixPOT>
   <data type="OnBeam">
   </data>
</bdtfile>

<!-- ================================================== BDT FILES [Now the training files]==================================================== -->
<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "FulloscTrain" hist_style = "hist" dirs = "" col = "(1.0,1.0,1.0)" plot_name = "FullOsc#nu_{e} Train" weight="GENIE_CCQE_wgt*wgt">
    <definition>
        <cut> (backgroundType==1||backgroundType==2||backgroundType==3) </cut>
		<cut>  ibkgd ==1</cut> <!--CCQE-->
        <cut> Entry$%2==1 </cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 6.639e19 </fixPOT>
</bdtfile>

<!--all background-->
<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "abTrain" hist_style = "hist" dirs = "" col = "(0.81,0.37,0.38)" plot_name = "All bkg Train" weight="wgt">
    <definition>
        <cut> ibkgd!=1 </cut>
        <cut> Entry$%2==1 </cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 1 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "pi0Train" hist_style = "hist" dirs = "" col = "(0.81,0.37,0.38)" plot_name = "#pi^{0} Train" weight = "wgt" >
    <definition>
        <cut> backgroundType==9 </cut>
        <cut> ibkgd!=1 </cut>
        <cut> Entry$%2==1 </cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 2.054E21 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "other_numuTrain" hist_style = "hist" dirs = "" col = "(163,143,163)" plot_name = "#bar{#nu}_{#mu}/#nu_{#mu} Train" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> backgroundType==11 </cut>
        <cut> ibkgd!=1 </cut>
        <cut> Entry$%2==1 </cut>
		<cut> MCBEAM.ntp&gt;2</cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 2.054E21 </fixPOT>
</bdtfile>


<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "dirtTrain" hist_style = "hist" dirs = "" col = "(137,104,89)" plot_name = "dirt Train" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> ibkgd!=1 </cut>
        <cut> Entry$%2==1 </cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 2.054E21 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "deltaTrain" hist_style = "hist" dirs = "" col = "(222,186,135)" plot_name = "#Delta#rightarrow N#gamma Train" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> backgroundType==10 </cut>
        <cut> ibkgd!=1 </cut>
        <cut> Entry$%2==1 </cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 2.054E21 </fixPOT>
</bdtfile>

<bdtfile filename = "timing2.0_MC_nuebar_may07.root" tag = "nueTrain" hist_style = "hist" dirs = "" col = "(176,207,199)" plot_name = "Intrinsic #nu_{e} Train" scale = "1.0" signal = "false" plot_on_top = "false" weight = "wgt">
    <definition>
        <cut> ibkgd!=1 </cut>
        <cut> (backgroundType&gt;0) </cut>
        <cut> (backgroundType&lt;6) </cut>
        <cut> Entry$%2==1 </cut>
    </definition>
    <training>
        <cut> 1 </cut>
     </training>
	<fixPOT> 2.054e21 </fixPOT>
</bdtfile>

<!-- ============================================== ACTUAL BDT TMVA Setup ==================================== -->
<mva type="BDT" use="yes" tag = "AB" name ="All Background focused BDT" binning = "(36,0.9,1.0)">
    <method type = "XGBoost" use = "yes">
        <param> n_trees=2000</param>
        <param> tree_method=exact</param>
        <param> n_gpus=0</param>
        <param> objective=binary:logistic</param>
        <param> eval_metric=logloss</param>
        <param> min_child_weight=1</param> 
        <param> gamma=1.2</param>          <!--   Minimum reduction required to split . The larger gamma is, the more conservative the algorithm will be.    -->
        <param> max_depth=4</param>    <!-- How many layers deep each tree -->
        <param> eta=0.04</param>        <!-- Learning Rate -->
        <param> subsample=0.3</param> <!-- % of events passed to each tree -->
        <param> colsample_bytree= 0.95</param>   <!-- % of features that are passed to each tree  -->
        <param> verbosity=1</param>
    </method>
    <file
        bkg_train_tag= "abTrain" 
        bkg_test_tag = "abTrain"
        bkg_test_cut = "Entry$%5<2" 
        sig_train_tag= "FulloscTrain"
        sig_test_tag = "fullosc"
        sig_test_cut = "Entry$%5<2"
        />
    <scan min = "0.4" max = "0.9" steps="100"/>
</mva>
<!--1-->
<mva type="BDT" use="yes" tag = "PI0" name ="Pi0 focused BDT" binning = "(36,0.9,1.0)">
    <method type = "XGBoost" use = "yes">
        <param> n_trees=2000</param>
        <param> tree_method=exact</param>
        <param> n_gpus=0</param>
        <param> objective=binary:logistic</param>
        <param> eval_metric=logloss</param>
        <param> min_child_weight=1</param> 
        <param> gamma=1.2</param>          <!--   Minimum reduction required to split . The larger gamma is, the more conservative the algorithm will be.    -->
        <param> max_depth=4</param>    <!-- How many layers deep each tree -->
        <param> eta=0.04</param>        <!-- Learning Rate -->
        <param> subsample=0.3</param> <!-- % of events passed to each tree -->
        <param> colsample_bytree= 0.95</param>   <!-- % of features that are passed to each tree  -->
        <param> verbosity=1</param>
    </method>
    <file
        bkg_train_tag= "pi0Train" 
        bkg_test_tag = "pi0misid"
        bkg_test_cut = "Entry$%5<2" 
        sig_train_tag= "FulloscTrain"
        sig_test_tag = "fullosc"
        sig_test_cut = "Entry$%5<2"
        />
    <scan min = "0.4" max = "0.9" steps="100"/>
</mva>
<!--2-->
<mva type="BDT" use="yes" tag = "OtherNumu" name ="OtherNumu focused BDT" binning = "(36,0.9,1.0)">
    <method type = "XGBoost" use = "yes">
        <param> n_trees=1000</param>
        <param> tree_method=exact</param>
        <param> n_gpus=0</param>
        <param> objective=binary:logistic</param>
        <param> eval_metric=logloss</param>
        <param> min_child_weight=1</param> 
        <param> gamma=1.2</param>          <!--   Minimum reduction required to split . The larger gamma is, the more conservative the algorithm will be.    -->
        <param> max_depth=5</param>    <!-- How many layers deep each tree -->
        <param> eta=0.08</param>        <!-- Learning Rate -->
        <param> subsample=0.3</param> <!-- % of events passed to each tree -->
        <param> colsample_bytree= 0.95</param>   <!-- % of features that are passed to each tree  -->
        <param> verbosity=1</param>
    </method>
    <file
        bkg_train_tag= "other_numuTrain" 
        bkg_test_tag = "other_numu"
        bkg_test_cut = "Entry$%5<2" 
        sig_train_tag= "FulloscTrain"
        sig_test_tag = "fullosc"
        sig_test_cut = "Entry$%5<2"
        />
    <scan min = "0.4" max = "0.9" steps="100"/>
</mva>

<mva type="BDT" use="yes" tag = "Dirt" name ="Dirt focused BDT" binning = "(36,0.9,1.0)">
    <method type = "XGBoost" use = "yes">
        <param> n_trees=1000</param>
        <param> tree_method=exact</param>
        <param> n_gpus=0</param>
        <param> objective=binary:logistic</param>
        <param> eval_metric=logloss</param>
        <param> min_child_weight=1</param> 
        <param> gamma=1.2</param>          <!--   Minimum reduction required to split . The larger gamma is, the more conservative the algorithm will be.    -->
        <param> max_depth=5</param>    <!-- How many layers deep each tree -->
        <param> eta=0.08</param>        <!-- Learning Rate -->
        <param> subsample=0.3</param> <!-- % of events passed to each tree -->
        <param> colsample_bytree= 0.95</param>   <!-- % of features that are passed to each tree  -->
        <param> verbosity=1</param>
    </method>
    <file
        bkg_train_tag= "dirtTrain" 
        bkg_test_tag = "dirt"
        bkg_test_cut = "Entry$%5<2" 
        sig_train_tag= "FulloscTrain"
        sig_test_tag = "fullosc"
        sig_test_cut = "Entry$%5<2"
        />
    <scan min = "0.4" max = "0.9" steps="100"/>
</mva>
<mva type="BDT" use="yes" tag = "Delta" name ="Delta focused BDT" binning = "(36,0.9,1.0)">
    <method type = "XGBoost" use = "yes">
        <param> n_trees=1000</param>
        <param> tree_method=exact</param>
        <param> n_gpus=0</param>
        <param> objective=binary:logistic</param>
        <param> eval_metric=logloss</param>
        <param> min_child_weight=1</param> 
        <param> gamma=1.2</param>          <!--   Minimum reduction required to split . The larger gamma is, the more conservative the algorithm will be.    -->
        <param> max_depth=5</param>    <!-- How many layers deep each tree -->
        <param> eta=0.08</param>        <!-- Learning Rate -->
        <param> subsample=0.3</param> <!-- % of events passed to each tree -->
        <param> colsample_bytree= 0.95</param>   <!-- % of features that are passed to each tree  -->
        <param> verbosity=1</param>
    </method>
    <file
        bkg_train_tag= "deltaTrain" 
        bkg_test_tag = "delta"
        bkg_test_cut = "Entry$%5<2" 
        sig_train_tag= "FulloscTrain"
        sig_test_tag = "fullosc"
        sig_test_cut = "Entry$%5<2"
        />
    <scan min = "0.4" max = "0.9" steps="100"/>
</mva>
<mva type="BDT" use="yes" tag = "Nue" name ="Nue focused BDT" binning = "(36,0.9,1.0)">
    <method type = "XGBoost" use = "yes">
        <param> n_trees=1000</param>
        <param> tree_method=exact</param>
        <param> n_gpus=0</param>
        <param> objective=binary:logistic</param>
        <param> eval_metric=logloss</param>
        <param> min_child_weight=1</param> 
        <param> gamma=1.2</param>          <!--   Minimum reduction required to split . The larger gamma is, the more conservative the algorithm will be.    -->
        <param> max_depth=5</param>    <!-- How many layers deep each tree -->
        <param> eta=0.08</param>        <!-- Learning Rate -->
        <param> subsample=0.3</param> <!-- % of events passed to each tree -->
        <param> colsample_bytree= 0.95</param>   <!-- % of features that are passed to each tree  -->
        <param> verbosity=1</param>
    </method>
    <file
        bkg_train_tag= "nueTrain" 
        bkg_test_tag = "intrinsicnue"
        bkg_test_cut = "Entry$%5<2" 
        sig_train_tag= "FulloscTrain"
        sig_test_tag = "fullosc"
        sig_test_cut = "Entry$%5<2"
        />
    <scan min = "0.4" max = "0.9" steps="100"/>
</mva>
<!-- ================================================== PRE-CUTS   ==================================================== -->

<!--
<precut def = "el.EnuQE<1250&amp;&amp;el.EnuQE>200" name = "EnuQE Cut"/>

<precut def = "miniPI0_mva>0.33 &amp;&amp; miniPI0_mva<0.66" name = " BDT cut"/>
<precut def = "intromecPI0_mva<0.5" name = " BDT cut"/>
<precut def = "intromecAB_mva<0.7" name = " BDT cut"/>
<precut def = "genieAB_mva<0.75" name = " BDT cut"/>
<precut def ="!(geniePI0_mva>0.85&amp;&amp;genieOtherNumu_mva>0.95&amp;&amp;genieDirt_mva>0.95&amp;&amp;genieDelta_mva>0.95&amp;&amp;genieNue_mva>0.95)" name = "multipleBDT"/>
<precut def = "genieAB_mva<0.33" name = " BDT cut"/>
<precut def = "el.EnuQE<1250&amp;&amp;el.EnuQE>200" name = "EnuQE Cut"/>
-->
<precut def = "el.EnuQE<1250&amp;&amp;el.EnuQE>200" name = "EnuQE Cut"/>
<precut def = "el.R<400" name = "R Cut"/>


<alias key = "leptonP" value = "sqrt(pow(el.E,2)+el.E*0.511)"/>
<alias key = "Enu" value ="sqrt(pow(el.UZ*#leptonP#,2)-0.511*0.511) -25"/>
<alias key = "Qsquare2" value ="(2*el.EnuQE*(el.E+0.511)*(1-#leptonP#/(el.E+0.511)*el.UZ)-pow(0.511,2))"/>
<alias key = "Qsquare" value ="-pow(0.511,2)+2*el.EnuQE*((el.E+0.511)-sqrt(pow(el.E+0.511,2)-pow(0.511,2))*el.UZ) "/>

<!-- ============================================== Variables, BDT training and otherwise ====================================== -->
<!--group 0: observable; group1: special; group 3: BDT-->

<var def = "el.R" binning="(12,0,600)" unit = "R [cm]" type = "d" logplot = "false"  training = "012345" group = "0"/>
<var def = "el.X" binning="(20,-600,600)" unit = "X [cm]" type = "d" logplot = "false"  training = "012345"/>
<var def = "el.Y" binning="(20,-600,600)" unit = "Y [cm]" type = "d" logplot = "false"  training = "012345"/>
<var def = "el.Z" binning="(20,-600,600)" unit = "Z [cm]" type = "d" logplot = "false"  training = "012345"/>
<var def = "el.EnuQE" binning="(24,100,1300)" unit = "E_{#nu}^{QE} [MeV]" type = "d" logplot = "false"  training = "" group = "0"/>

<var def = "el.EnuQE" binning="(24,100,1300)" unit = "E_{#nu}^{QE} [MeV] (high BDT)" type = "d" logplot = "false"  training = "" group = "1"/>
<!--6-->
<var def = "sqrt(2*939.57*( #Enu# - el.E)+pow(939.57,2)-#Qsquare#)" binning="(25,0,1500)" unit = "MECness W" type = "d" logplot = "false"  training = "" group = "1"/>

<var def = "el.EnuQE" binning="(24,100,1300)" unit = "E_{#nu}^{QE} [MeV](log)" type = "d" logplot = "true"  training = "" group = "1"/>
<var def = "el.EnuQE" binning="(20,0,3000)" unit = "E_{#nu}^{QE} [MeV] (full)" type = "d" logplot = "false"  training = "" group = "1"/>
<var def = "el.E" binning="(24,100,1300)" unit = "Visible Energy [MeV]" type = "d" logplot = "false"  training = "012345" group = "0"/>

<!--10 is below-->
<var def = "el.UZ" binning="(20,-1,1)" unit = "cos#theta" type = "d" logplot = "false"  training = "012345" group = "0"/>
<var def = "el.UZ" binning="(20,0.8,1)" unit = "cos#theta (zoome-in)" type = "d" logplot = "false"  training = "" group = "1"/>
<var def = "el.UY" binning="(8,-1,1)" unit = "UY" type = "d" logplot = "false"  training = "012345"/>
<var def = "el.UX" binning="(8,-1,1)" unit = "UX" type = "d" logplot = "false"  training = "012345"/>

<var def = "mu.F - el.F" binning= "(20,-0.1,1)" unit ="electron/muon log likelihood" type = "d" logplot = "false"  training = "012345" group ="1"/>
<var def = "piFix.F - el.F" binning= "(20,-0.08,0.08)" unit ="electron/pion log likelihood" type = "d" logplot = "false"  training = "012345" group ="1"/>


<var def = "sqrt(pow(el.UY,2)+pow(el.UX,2))" binning="(8,0,1)" unit = "#sqrt{UY^{2}+UX^{2}}" type = "d" logplot = "false"  training = ""/>
<var def = " piNoFix.M " binning="(14,0,300)" unit = "Pi0 Mass" type = "d" logplot = "false"  training = "" group = ""/>
<var def = "el.RtoWallB" binning="(20,0,1000)" unit = "R to Wall backward[cm]" type = "d" logplot = "false"  training = "" group = "1"/>
<var def = "el.RtoWallF" binning="(22,0,1100)" unit = "R to Wall forward[cm]" type = "d" logplot = "false"  training = "" group = "1"/>

<!--20 BDT stuffs-->
<var def = "genieAB_mva" binning = "(24,-0.1,1.1)" unit = "All Bkg BDT Score" type="d" training= "" logplot="false" group = "3"/> 
<var def = "geniePI0_mva" binning = "(24,-0.1,1.1)" unit = "PI0 BDT Score" type="d" training= "" logplot="false" group = "3"/> 
<var def = "genieOtherNumu_mva" binning = "(24,-0.1,1.1)" unit = "Other Numu BDT Score" type="d" training= "" logplot="false" group = "3"/> 
<var def = "genieDirt_mva" binning = "(24,-0.1,1.1)" unit = "Dirt BDT Score" type="d" training= "" logplot="false" group = "3"/> 
<var def = "genieDelta_mva" binning = "(24,-0.1,1.1)" unit = "Delta BDT Score" type="d" training= "" logplot="false" group = "3"/> 
<var def = "genieNue_mva" binning = "(24,-0.1,1.1)" unit = "Other Nue BDT Score" type="d" training= "" logplot="false" group = "3"/> 


